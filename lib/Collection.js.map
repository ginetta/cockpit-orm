{"version":3,"sources":["../src/Collection.js"],"names":["Collection","Entry","cockpit","collectionName","options","skip","total","lang","_getEntries","entries","x","_getData","data","limit","collection","collectionSchema","then","fields","extraOptions","collectionGet","getOptions","console","log","slug","filters","slugField","field","fetch","get","watch","on","event","mapEntries","error","map","e"],"mappings":"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","file":"Collection.js","sourcesContent":["import { entriesHead } from './utils';\n\nexport default class Collection {\n  static slugField = 'name_slug';\n\n  collectionName = '';\n  cockpit = {};\n\n  skip = 0;\n  total = 0;\n  lang = '';\n\n  _getEntries = x => ({ entries }) => x(entries);\n  _getData = x => ({ data }) => x(data);\n\n  constructor({ Entry, cockpit, collectionName, ...options }) {\n    this.options = {\n      limit: this.limit,\n      lang: this.lang,\n      ...options,\n    };\n\n    this.collectionName = collectionName;\n    this.cockpit = cockpit;\n    this.Entry = Entry;\n\n    this.collection = cockpit.collection(this.collectionName, this.options);\n  }\n\n  getFields() {\n    return this.cockpit\n      .collectionSchema(this.collectionName)\n      .then(({ fields }) => fields);\n  }\n\n  getEntries(fields, extraOptions) {\n    return this.cockpit\n      .collectionGet(\n        this.collectionName,\n        this.getOptions({ ...extraOptions, fields }),\n      )\n      .then(({ entries }) => {\n        console.log('entries: ', entries);\n        return entries;\n      });\n  }\n\n  fetch(fields, extraOptions) {\n    return this.cockpit.collection(\n      this.collectionName,\n      this.getOptions({ ...extraOptions, fields }),\n    );\n  }\n\n  getOneBySlug(slug, filters) {\n    return entriesHead(\n      this.cockpit.collection(this.collectionName, {\n        ...this.options,\n        filters: {\n          [this.slugField]: slug,\n          ...filters,\n        },\n      }),\n    );\n  }\n\n  getOneByFieldSlug(field, slug, filters) {\n    return entriesHead(\n      this.cockpit.collection(this.collectionName, {\n        ...this.options,\n        filters: {\n          [this.slugField]: slug,\n          ...filters,\n        },\n      }),\n    );\n  }\n\n  getObject(fields, extraOptions) {\n    const fetch = this.fetch(fields, extraOptions);\n\n    return {\n      get: x => fetch.get(this._getEntries(x)),\n      watch: x => fetch.watch(this._getEntries(x)),\n      on: (event, x) => fetch.on(event, this._getData(x)),\n    };\n  }\n\n  entities(fields, extraOptions) {\n    const fetch = this.fetch(fields, extraOptions);\n\n    return {\n      get: x => fetch.get(this.mapEntries(x)),\n      watch: x => fetch.watch(this.mapEntries(x)),\n      on: (event, x) => fetch.on(event, this._getData(x)),\n    };\n  }\n\n  mapEntries(x) {\n    if (!this.Entry) {\n      console.error(\n        `You must specify a Entry class for this Collection: ${\n          this.collectionName\n        }`,\n      );\n    }\n\n    return ({ entries }) => x(entries.map(e => new this.Entry(e)));\n  }\n\n  getOptions(extraOptions) {\n    return {\n      ...this.options,\n      limit: this.limit,\n      lang: this.lang,\n      ...extraOptions,\n    };\n  }\n\n  setLanguage(lang) {\n    this.lang = lang;\n  }\n\n  getLanguage() {\n    return this.lang;\n  }\n}\n"]}